httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Desktop/testing.json')
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Desktop/testing.json')
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Elasticidadete",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Desktop/test_final.json')
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Envis",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Pilling",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_RasgoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_RasgoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Rasgote",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_RasgoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_RasgoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Tracao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_TracaoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_TracaoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_VaporTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_VaporTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_VaporTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://172.16.131.99:8080/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Desktop/test_final.json')
httr::POST("http://127.0.0.1:8000/predict_Pilling",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Downloads/response_1579600644570.json')
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Downloads/response_1579600644570.json')
httr::POST("http://127.0.0.1:8000/predict_Abrasao",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_DeslizamentoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ElasticidadeTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Envis",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_ExResTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_Pilling",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_RasgoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_RasgoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_TracaoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_TracaoTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_VaporTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_VaporTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://127.0.0.1:8000/predict_VaporTr",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
httr::POST("http://172.16.131.99:8080/predict_DeslizamentoTe",encode = "json",body = json_abr,
httr::add_headers(`accept` = 'application/json'),
httr::content_type('application/json')) %>%
httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Downloads/20200203_153447_Dtr.json')
httr::POST("http://172.16.131.99:8080/predict_Abrasao",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
library(dplyr)
httr::POST("http://172.16.131.99:8080/predict_Abrasao",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://172.16.131.99:8080/predict_DeslizamentoTe",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://172.16.131.99:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.1.0.0:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
json_abr <- readr::read_file('C:/Users/antonio.silva/Downloads/20200203_153447_Dtr.json')
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://172.16.131.99:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
install.packages("h2o", type="source", repos="https://h2o-release.s3.amazonaws.com/h2o/rel-yates/3/R")
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
R
Sys.getenv("R_HOME")
httr::POST("http://127.0.0.1:8080/predict_DeslizamentoTr",encode = "json",body = json_abr, httr::content_type('application/json')) %>% httr::content()
file.edit('C:/Users/antonio.silva/Desktop/Texboost_API/textboost_test/Api_total.r')
Sys.getenv("R_HOME")
confirmed <- read_csv(file = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv")
library(readr)
confirmed <- read_csv(file = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv")
View(confirmed)
View(confirmed %>% filter(`Country/Region`=="France"))
library(dplyr)
View(confirmed %>% filter(`Country/Region`=="France"))
setwd('C:/Users/antonio.silva/Documents/coronavirus/')
library(ProjectTemplate)
load.project()
evolution_of_confirmed <- confirmed %>%
filter(!Confirmed==0) #%>%
countries <- c("China","Italy","Spain","Portugal","US", "United Kingdom", "Germany", "France")
evolution_of_confirmed_v2 <- evolution_of_confirmed %>%
group_by(Country, Date) %>%
summarise(Confirmed = sum(Confirmed), Confirmed_day = sum(Confirmed_day)) %>%
ungroup() %>%
group_by(Country) %>%
arrange(Date) %>%
mutate(day_after = row_number(),
day_after_10 = if_else(Confirmed>10,1,0)) %>%
ungroup() %>%
group_by(Country) %>%
arrange(Date) %>%
mutate(day_after_10 = cumsum(day_after_10),
Confirmed = if_else((Country=="United Kingdom") & (Date == as.Date("2020-03-15")),1391,Confirmed))
evolution_of_confirmed_v2 %>%
filter(Country %in% countries) %>%
mutate(Confirmed = log10(Confirmed)) %>%
plot_ly() %>%
add_trace(x=~day_after_10, y=~Confirmed, color=~Country, type = "scatter", mode = "lines")
evolution_of_confirmed_v2 %>%
filter(Country %in% countries) %>%
mutate(Confirmed = log10(Confirmed)) %>%
plot_ly() %>%
add_trace(x=~day_after, y=~Confirmed, color=~Country, type = "scatter", mode = "lines")
evolution_of_confirmed_v2 %>%
mutate(Confirmed = Confirmed) %>%
filter(Country %in% countries) %>%
#filter(!Country %in% c("China")) %>%
plot_ly() %>%
add_trace(x=~day_after, y=~Confirmed, color=~Country, type = "scatter", mode = "lines")
# previsoes a partir de 18 de marco
today_cases <- evolution_of_confirmed_v2 %>%
filter(Country == "Portugal") %>%
ungroup() %>%
# tibble::add_row(Country = "Portugal",
#                 Date = as.Date("2020-03-15"),
#                 Confirmed = 245,
#                 Confirmed_day = 76,
#                 day_after = 14,
#                 day_after_10 = 10) %>%
select(Date, day_after, Confirmed) %>%
#tibble::add_row(Date = as.Date("2020-03-16"), day_after = 15, Confirmed = NA) %>%
#tibble::add_row(Date = as.Date("2020-03-17"), day_after = 16, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-18"), day_after = 17, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-19"), day_after = 18, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-20"), day_after = 19, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-21"), day_after = 20, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-22"), day_after = 21, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-23"), day_after = 22, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-24"), day_after = 23, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-25"), day_after = 24, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-26"), day_after = 25, Confirmed = NA)
exponential.model <- lm(log(Confirmed) ~ day_after, data = today_cases)
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict)) %>%
plot_ly() %>%
add_trace(x=~Date, y=~predict,name = "Prediction", line = list(color = 'rgb(205, 12, 24)', width = 0.5, dash = 'dot')) %>%
add_trace(x=~Date, y=~Confirmed, mode = "marker", name = "Real") %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = "Number of Cases"),
title = "Prediction of future cases in Portugal")
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict))
plot_web <- data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict)) %>%
plot_ly() %>%
add_trace(x=~Date, y=~predict,name = "Prediction", line = list(color = 'rgb(205, 12, 24)', width = 0.5, dash = 'dot')) %>%
add_trace(x=~Date, y=~Confirmed, mode = "marker", name = "Real") %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = "Number of Cases"),
title = "Prediction of future cases in Portugal")
chart_link <-  api_create(plot_web, filename="portugal-covid19")
Sys.setenv("plotly_username"="joaosilvagmr")
Sys.setenv("plotly_api_key"="Yq2TH9JaMNKOzwBVptaa")
plot_web <- data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict)) %>%
plot_ly() %>%
add_trace(x=~Date, y=~predict,name = "Prediction", line = list(color = 'rgb(205, 12, 24)', width = 0.5, dash = 'dot')) %>%
add_trace(x=~Date, y=~Confirmed, mode = "marker", name = "Real") %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = "Number of Cases"),
title = "Prediction of future cases in Portugal")
chart_link <-  api_create(plot_web, filename="portugal-covid19")
chart_link
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict))
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict),
predict = if_else(!is.na(Confirmed),NA,predict))
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict),
predict = if_else(!is.na(Confirmed),0,predict))
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict),
predict = if_else(!is.na(Confirmed),0,predict),
predict = replace(0, NA))
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict),
predict = if_else(!is.na(Confirmed),0,predict)) %>%
na_if(0, NA)
data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict),
predict = if_else(!is.na(Confirmed),0,predict)) %>%
na_if(0)
plot_web <- data.frame(exp(predict(object = exponential.model, newdata = today_cases))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict),
predict = if_else(!is.na(Confirmed),0,predict)) %>%
na_if(0) %>%
plot_ly() %>%
add_trace(x=~Date, y=~predict,name = "Prediction", line = list(color = 'rgb(205, 12, 24)', width = 0.5, dash = 'dot')) %>%
add_trace(x=~Date, y=~Confirmed, mode = "marker", name = "Real") %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = "Number of Cases"),
title = "Prediction of future cases in Portugal")
chart_link <-  api_create(plot_web, filename="portugal-covid19")
chart_link
today_cases <- evolution_of_confirmed_v2 %>%
filter(Country == "Spain") %>%
ungroup() %>%
filter(Date > as.Date("2020-02-23")) %>%
select(Date, day_after, Confirmed) %>%
arrange(Date) %>%
mutate(day_after = row_number()) %>%
tibble::add_row(Date = as.Date("2020-03-17"), day_after = 23, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-18"), day_after = 24, Confirmed = NA)
today_cases_train <- today_cases %>%
mutate(Confirmed = if_else(day_after>18,0,Confirmed)) %>%
na_if(., 0)
exponential.model <- lm(log(Confirmed) ~ day_after, data = today_cases_train)
data.frame(exp(predict(object = exponential.model, newdata = today_cases_train))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict)) %>%
plot_ly() %>%
add_trace(x=~Date, y=~predict,name = "Prediction", line = list(color = 'rgb(205, 12, 24)', width = 0.5, dash = 'dot')) %>%
add_trace(x=~Date, y=~Confirmed, mode = "marker", name = "Real") %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = "Number of Cases"),
title = "Prediction of future cases in Spain")
today_cases <- evolution_of_confirmed_v2 %>%
filter(Country == "Spain") %>%
ungroup() %>%
filter(Date > as.Date("2020-02-23")) %>%
select(Date, day_after, Confirmed) %>%
arrange(Date) %>%
mutate(day_after = row_number()) %>%
#tibble::add_row(Date = as.Date("2020-03-17"), day_after = 23, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-18"), day_after = 24, Confirmed = 13716) %>%
tibble::add_row(Date = as.Date("2020-03-19"), day_after = 25, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-20"), day_after = 26, Confirmed = NA) %>%
tibble::add_row(Date = as.Date("2020-03-21"), day_after = 27, Confirmed = NA)
today_cases_train <- today_cases %>%
mutate(Confirmed = if_else(day_after>24,0,Confirmed)) %>%
na_if(., 0)
exponential.model <- lm(log(Confirmed) ~ day_after, data = today_cases_train)
data.frame(exp(predict(object = exponential.model, newdata = today_cases_train))) %>%
rename(predict = 1) %>%
bind_cols(today_cases) %>%
select(Date, day_after, Confirmed, predict) %>%
mutate(predict = floor(predict)) %>%
plot_ly() %>%
add_trace(x=~Date, y=~predict,name = "Prediction", line = list(color = 'rgb(205, 12, 24)', width = 0.5, dash = 'dot')) %>%
add_trace(x=~Date, y=~Confirmed, mode = "marker", name = "Real") %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = "Number of Cases"),
title = "Prediction of future cases in Spain")
View(today_cases_train)
